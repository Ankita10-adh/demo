{% load static %}

{% block body %}

{% include 'user_navigation.html' %}

<style>
    /* Inherit User theme colors */
    :root {
        --user-primary: #6a11cb; /* Deep Purple */
        --user-secondary: #2575fc; /* Bright Blue */
        --user-bg: #f7f9fc;
        --user-text: #2c3e50;
    }

    /* Card container for the form */
    .password-card {
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        padding: 40px;
        max-width: 500px; /* Constrain width for better focus */
        margin: 50px auto;
        border-top: 5px solid var(--user-primary); /* Accent line */
    }

    /* Form control styling */
    .form-control {
        border-radius: 8px;
        padding: 10px;
        border: 1px solid #ced4da;
        font-size: 1rem;
        margin-bottom: 15px;
    }

    .form-label {
        font-weight: 600;
        color: var(--user-text);
        margin-bottom: 5px;
    }

    /* Submit Button Styling */
    .btn-submit {
        background: linear-gradient(90deg, var(--user-primary), var(--user-secondary));
        border: none;
        color: white;
        font-weight: 600;
        padding: 10px 20px;
        border-radius: 8px;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 15px;
    }

    .btn-submit:hover {
        opacity: 0.9;
        transform: translateY(-1px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
</style>

<script>
    function checkPass() {
        const newPassword = document.changepassword.newpassword.value;
        const confirmPassword = document.changepassword.confirmpassword.value;

        if (newPassword !== confirmPassword) {
            alert('Error: New Password and Confirm Password fields must match.');
            document.changepassword.confirmpassword.focus();
            return false;
        }
        return true; 
    }
</script>

<div class="container">
    <div class="password-card">
        <h3 class="mb-4 text-center text-primary fw-bold">
            <i class="fa-solid fa-user-lock me-2"></i> Update Your Password
        </h3>
        
        <form method="post" name="changepassword" onsubmit="return checkPass()">
            {% csrf_token %}
            
            <div class="mb-3">
                <label for="currentpassword" class="form-label">Current Password</label>
                <input type="password" class="form-control" id="currentpassword" name="currentpassword" required>
            </div>

            <div class="mb-3">
                <label for="newpassword" class="form-label">New Password</label>
                <input type="password" class="form-control" id="newpassword" name="newpassword" required>
            </div>

            <div class="mb-4">
                <label for="confirmpassword" class="form-label">Confirm New Password</label>
                <input type="password" class="form-control" id="confirmpassword" name="confirmpassword" required>
            </div>

            <button type="submit" class="btn btn-submit">
                <i class="fa-solid fa-arrows-rotate me-2"></i> Change Password
            </button>
        </form>
    </div>
</div>

---



{% if error == "No" %}
<script>
    // Success: Logs out the user after a successful change for security.
    alert("Success: Your password was changed successfully! You will now be logged out for your security.");
    window.location = "{% url 'Logout' %}";
</script>
{% endif %}

{% if error == "yes" %}
<script>
    // General failure
    alert("System Error: Something went wrong during the update process. Please try again.");
</script>
{% endif %}

{% if error == "Not" %}
<script>
    // Authentication failure
    alert("Authentication Error: The current password you entered is incorrect. Please verify and try again.");
</script>
{% endif %}


{% endblock %}